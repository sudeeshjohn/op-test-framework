
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>common.OpTestOpenBMC &#8212; op-test-framework pre-v1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for common.OpTestOpenBMC</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># OpenPOWER Automated Test Project</span>
<span class="c1">#</span>
<span class="c1"># Contributors Listed Below - COPYRIGHT 2017</span>
<span class="c1"># [+] International Business Machines Corp.</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span>
<span class="c1"># implied. See the License for the specific language governing</span>
<span class="c1"># permissions and limitations under the License.</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pexpect</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">cgi</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">OpTestSSH</span> <span class="k">import</span> <span class="n">OpTestSSH</span>
<span class="kn">from</span> <span class="nn">OpTestBMC</span> <span class="k">import</span> <span class="n">OpTestBMC</span>
<span class="kn">from</span> <span class="nn">Exceptions</span> <span class="k">import</span> <span class="n">HTTPCheck</span>
<span class="kn">from</span> <span class="nn">Exceptions</span> <span class="k">import</span> <span class="n">CommandFailed</span>
<span class="kn">from</span> <span class="nn">OpTestConstants</span> <span class="k">import</span> <span class="n">OpTestConstants</span> <span class="k">as</span> <span class="n">BMC_CONST</span>
<span class="kn">import</span> <span class="nn">OpTestSystem</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">OpTestLogger</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">OpTestLogger</span><span class="o">.</span><span class="n">optest_logger_glob</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="HostManagement"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement">[docs]</a><span class="k">class</span> <span class="nc">HostManagement</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    HostManagement Class</span>
<span class="sd">    OpenBMC methods to manage the Host</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">ip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="n">conf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">util</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">PingFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">totalSleepTime</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">PING_RETRY_FOR_STABILITY</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="s1">&#39;REST&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_bmc_runtime</span><span class="p">()</span>

<div class="viewcode-block" id="HostManagement.get_inventory"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">get_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Inventory Enumerate</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/inventory/enumerate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/inventory/enumerate&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.sensors"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.sensors">[docs]</a>    <span class="k">def</span> <span class="nf">sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sensor Enumerate</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/sensors/enumerate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/sensors/enumerate&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.get_power_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_power_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_power_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get Current Host Power State</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/host0/attr/CurrentHost</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s1">&#39;/xyz/openbmc_project/state/host0/attr/CurrentHostState&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.get_host_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_host_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_host_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get Host State</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/host0/attr/CurrentHostState</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s1">&#39;/xyz/openbmc_project/state/host0/attr/CurrentHostState&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.soft_reboot"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.soft_reboot">[docs]</a>    <span class="k">def</span> <span class="nf">soft_reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reboot Server Gracefully</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.State.Host.Transition.Reboot&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.Host.Transition.Reboot&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.hard_reboot"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.hard_reboot">[docs]</a>    <span class="k">def</span> <span class="nf">hard_reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reboot Server Immediately</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.State.Host.Transition.Reboot&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.Host.Transition.Reboot&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.power_soft"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_soft">[docs]</a>    <span class="k">def</span> <span class="nf">power_soft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Power Soft Server</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.State.Chassis.Transition.Off&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.Chassis.Transition.Off&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.power_off"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_off">[docs]</a>    <span class="k">def</span> <span class="nf">power_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Power Off Server</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.State.Chassis.Transition.Off&quot;</span>

<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.State.Chassis.Transition.Off&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.Chassis.Transition.Off&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>

        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.Host.Transition.Off&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.power_on"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_on">[docs]</a>    <span class="k">def</span> <span class="nf">power_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Power On Server</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.State.Host.Transition.On&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.Host.Transition.On&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.list_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.list_sel">[docs]</a>    <span class="k">def</span> <span class="nf">list_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List SEL</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/logging/enumerate</span>
<span class="sd">        &quot;data&quot; : []</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;List of SEL entries&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/logging/enumerate&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.pull_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.pull_ids">[docs]</a>    <span class="k">def</span> <span class="nf">pull_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Pull SEL IDs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sel_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sels</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/xyz/openbmc_project/logging/entry/(\d{1,})$&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">)))</span>
                <span class="n">sel_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">id_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="c1"># sample id_list [&#39;81&#39;, &#39;82&#39;, &#39;83&#39;, &#39;84&#39;]</span>
        <span class="k">return</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">sel_dict</span></div>

<div class="viewcode-block" id="HostManagement.get_sel_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_sel_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_sel_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Build a sorted id_list from the SELs and also</span>
<span class="sd">        build a list of dictionary items containing the</span>
<span class="sd">        SEL and ESEL information</span>

<span class="sd">        :param dump: Set to True if a printed output is desired.</span>
<span class="sd">        :type dump: Boolean</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_sel</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;json_data=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json_data</span><span class="p">))</span>
        <span class="n">id_list</span><span class="p">,</span> <span class="n">sel_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_ids</span><span class="p">(</span><span class="n">sels</span><span class="o">=</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>

        <span class="c1"># sample sel_dict.get(j)=/xyz/openbmc_project/logging/entry/78</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="n">dict_item</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">))</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">)))</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Message&#39;</span><span class="p">)</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Description&#39;</span><span class="p">)</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Severity&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Resolved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Resolved&#39;</span><span class="p">)</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;EventID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EventID&#39;</span><span class="p">)</span>
            <span class="n">add_data</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">sel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)][</span><span class="s1">&#39;AdditionalData&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">add_data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;ESEL&quot;</span> <span class="ow">in</span> <span class="n">add_data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;esel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;PROCEDURE&quot;</span> <span class="ow">in</span> <span class="n">add_data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;Procedure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">add_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dump</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------------------------------------------------------------------&quot;</span>
            <span class="nb">print</span> <span class="s2">&quot;SELs&quot;</span>
            <span class="nb">print</span> <span class="s2">&quot;----------------------------------------------------------------------&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;SEL has no entries&quot;</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Id          : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">))</span>
                <span class="nb">print</span> <span class="s2">&quot;Message     : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Message&#39;</span><span class="p">))</span>
                <span class="nb">print</span> <span class="s2">&quot;Description : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Description&#39;</span><span class="p">))</span>
                <span class="nb">print</span> <span class="s2">&quot;Timestamp   : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">))</span>
                <span class="nb">print</span> <span class="s2">&quot;Severity    : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Severity&#39;</span><span class="p">))</span>
                <span class="nb">print</span> <span class="s2">&quot;Resolved    : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Resolved&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EventID&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;EventID     : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EventID&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Procedure&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;Procedure   : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Procedure&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;esel&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;ESEL        : characters=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;esel&#39;</span><span class="p">)))</span>
                    <span class="nb">print</span> <span class="s2">&quot;Ruler        : 0123456789012345678901234567890123456789012345678901234567890123&quot;</span>
                    <span class="nb">print</span> <span class="s2">&quot;-------------------------------------------------------------------------------&quot;</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;esel&#39;</span><span class="p">)),</span> <span class="mi">64</span><span class="p">):</span>
                        <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">{:06d}</span><span class="s2">-</span><span class="si">{:06d}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">63</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;esel&#39;</span><span class="p">)[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">64</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;ESEL        : None&quot;</span>
                <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span> <span class="s2">&quot;----------------------------------------------------------------------&quot;</span>
        <span class="c1"># sample id_list [&#39;81&#39;, &#39;82&#39;, &#39;83&#39;, &#39;84&#39;]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;id_list=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_list</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dict_list=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">dict_list</span></div>

<div class="viewcode-block" id="HostManagement.clear_sel_by_id"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.clear_sel_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">clear_sel_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clear SEL by ID</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/logging/entry/&lt;id&gt;/action/Delete</span>
<span class="sd">        &quot;data&quot; : []</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Clearing SEL entries by id&quot;</span><span class="p">)</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">dict_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sel_ids</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;list=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dict_list=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/logging/entry/</span><span class="si">{}</span><span class="s2">/action/Delete&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.verify_clear_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.verify_clear_sel">[docs]</a>    <span class="k">def</span> <span class="nf">verify_clear_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Verify SEL is Cleared</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Check if SEL really has zero entries&quot;</span><span class="p">)</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">dict_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sel_ids</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;list=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dict_list=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_list</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.clear_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.clear_sel">[docs]</a>    <span class="k">def</span> <span class="nf">clear_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clear ALL SELs</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/logging/action/DeleteAll</span>
<span class="sd">        &quot;data&quot; : []</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Clearing ALL SELs DeleteAll&quot;</span><span class="p">)</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/logging/action/DeleteAll&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.get_current_bootdev"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_current_bootdev">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_bootdev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Current Boot Device Info</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/boot/attr/BootMode</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/attr/BootMode&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">bootmode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Setup&quot;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
            <span class="n">bootmode</span> <span class="o">=</span> <span class="s2">&quot;Setup&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Regular&quot;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
            <span class="n">bootmode</span> <span class="o">=</span> <span class="s2">&quot;Regular&quot;</span>
        <span class="k">return</span> <span class="n">bootmode</span></div>

<div class="viewcode-block" id="HostManagement.set_bootdev_to_setup"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_bootdev_to_setup">[docs]</a>    <span class="k">def</span> <span class="nf">set_bootdev_to_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set boot device to setup</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/boot/attr/BootMode</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.Control.Boot.Mode.Modes.Setup&quot;</span>

<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/boot/one_time/attr/Enabled</span>
<span class="sd">        &quot;data&quot;: 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/attr/BootMode&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.Control.Boot.Mode.Modes.Setup&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>

        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/one_time/attr/Enabled&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.set_bootdev_to_none"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_bootdev_to_none">[docs]</a>    <span class="k">def</span> <span class="nf">set_bootdev_to_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set boot device to regular/default</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/boot/attr/BootMode</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.Control.Boot.Mode.Modes.Regular&quot;</span>

<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/boot/one_time/attr/Enabled</span>
<span class="sd">        &quot;data&quot;: 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/attr/BootMode&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.Control.Boot.Mode.Modes.Regular&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>

        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/one_time/attr/Enabled&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.get_boot_progress"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_boot_progress">[docs]</a>    <span class="k">def</span> <span class="nf">get_boot_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Boot Progress Info</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip//xyz/openbmc_project/state/host0/attr/BootProgress</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/BootProgress&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_host_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_host_state">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_host_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_state</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait for OpenBMC Host state</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip//xyz/openbmc_project/state/host0</span>
<span class="sd">        &quot;data&quot; : []</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_bmc</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;/xyz/openbmc_project/state/host</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">),</span>
                     <span class="n">key</span><span class="o">=</span><span class="s2">&quot;CurrentHostState&quot;</span><span class="p">,</span>
                     <span class="n">value_target</span><span class="o">=</span><span class="s2">&quot;xyz.openbmc_project.State.Host.HostState.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_state</span><span class="p">),</span>
                     <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_standby"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_standby">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_standby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait for Standby</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_host_state</span><span class="p">(</span><span class="s2">&quot;Off&quot;</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_runtime"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_runtime">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait for Runtime</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_host_state</span><span class="p">(</span><span class="s2">&quot;Running&quot;</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.bmc_reset"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.bmc_reset">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        BMC reset</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/state/bmc0/attr/RequestedBMCTransition</span>
<span class="sd">        &quot;data&quot; : &quot;xyz.openbmc_project.State.BMC.Transition.Reboot&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/bmc0/attr/RequestedBMCTransition&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.State.BMC.Transition.Reboot&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="c1"># Wait for BMC to go down.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ping_fail_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">)</span>
        <span class="c1"># Wait for BMC to ping back.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">PingFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">totalSleepTime</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">PING_RETRY_POWERCYCLE</span><span class="p">)</span>
        <span class="c1"># Wait for BMC ready state.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_bmc_runtime</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.get_bmc_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_bmc_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_bmc_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get BMC State</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># caller drives retry</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/bmc0/attr/CurrentBMCState&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">problem</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">{}</span><span class="s2">] Description=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">HTTPCheck</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;HTTP problem getting CurrentBMCState </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.wait_bmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_bmc">[docs]</a>    <span class="k">def</span> <span class="nf">wait_bmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait on BMC</span>
<span class="sd">        Given a token, target, key wait for a match</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># handles data as a dictionary or string</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">minutes</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">token</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">value_target</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">value_target</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value_target</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;We timed out waiting for </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">, we waited </span><span class="si">{}</span><span class="s2"> minutes for </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">value_target</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">HTTPCheck</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;HTTP problem getting </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">, we waited </span><span class="si">{}</span><span class="s2"> minutes for </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">value_target</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_bmc_runtime"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_bmc_runtime">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_bmc_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait for BMC Runtime</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_bmc</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;/xyz/openbmc_project/state/bmc0/attr/CurrentBMCState&quot;</span><span class="p">,</span>
                     <span class="n">value_target</span><span class="o">=</span><span class="s2">&quot;xyz.openbmc_project.State.BMC.BMCState.Ready&quot;</span><span class="p">,</span>
                     <span class="n">minutes</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HostManagement.get_list_of_image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_list_of_image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_list_of_image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get list of image IDs</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image IDs=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()))</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/xyz/openbmc_project/software/(.*)&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="c1"># According to the OpenBMC docs, Image ID can be</span>
            <span class="c1"># Implementation defined, and thus, the word &#39;active&#39;</span>
            <span class="c1"># would be a valid ID.</span>
            <span class="c1"># Except that it isn&#39;t. The documentation is lies.</span>
            <span class="c1"># It seems that &#39;active&#39; is special.</span>
            <span class="c1"># There is no documentation as to what other</span>
            <span class="c1"># strings are special, or could become special.</span>
            <span class="c1"># So, HACK HACK HACK around it. :(</span>
            <span class="c1"># https://github.com/openbmc/phosphor-dbus-interfaces/tree/55d03ca/xyz/openbmc_project/Software#image-identifier</span>
            <span class="c1"># This is getting insane, it&#39;s not just &#39;active&#39;</span>
            <span class="c1"># It&#39;s &#39;functional&#39; as well. Or some other things.</span>
            <span class="c1"># So, we assume that if we don&#39;t have &#39;Purpose&#39; it&#39;s something special</span>
            <span class="c1"># like the &#39;active&#39; or (new) &#39;functional&#39;.</span>
            <span class="c1"># Adriana has promised me that this is safe into the future.</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;List of images id&#39;s: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ids</span></div>

<div class="viewcode-block" id="HostManagement.image_data"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.image_data">[docs]</a>    <span class="k">def</span> <span class="nf">image_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get Image Info By ID</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/id</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image ID=</span><span class="si">{}</span><span class="s2"> Data=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.upload_image"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.upload_image">[docs]</a>    <span class="k">def</span> <span class="nf">upload_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Upload an image, OpenBMC imposes validation on files uploaded</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/upload/image</span>
<span class="sd">        &quot;file&quot; : file-like-object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileload</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/upload/image&quot;</span>
            <span class="n">octet_hdr</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span> <span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
                                               <span class="n">headers</span><span class="o">=</span><span class="n">octet_hdr</span><span class="p">,</span>
                                               <span class="n">data</span><span class="o">=</span><span class="n">fileload</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">headers</span>
                <span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
                <span class="nb">print</span> <span class="n">r</span></div>

<div class="viewcode-block" id="HostManagement.get_image_priority"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_image_priority">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get Image Priority - 0=primary, boot side of the image</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image Data: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json_data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Priority&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.set_image_priority"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_image_priority">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set Image Priority</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/&lt;id&gt;/attr/Priority</span>
<span class="sd">        &quot;data&quot; : 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">{}</span><span class="s2">/attr/Priority&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="n">level</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.image_ready_for_activation"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.image_ready_for_activation">[docs]</a>    <span class="k">def</span> <span class="nf">image_ready_for_activation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Image Activation Ready</span>
<span class="sd">        IS THIS USED ?  CAN IT BE REMOVED ?</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image JSON : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json_data</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation&#39;</span><span class="p">)</span> \
                <span class="o">==</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.Activations.Ready&quot;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image upload is successful &amp; Ready for activation&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPCheck</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Image is not ready for activation/Timeout happened&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.activate_image"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.activate_image">[docs]</a>    <span class="k">def</span> <span class="nf">activate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Activate An Image</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/&lt;image id&gt;/attr/RequestedActivation</span>
<span class="sd">        &quot;data&quot;: &quot;xyz.openbmc_project.Software.Activation.RequestedActivations.Active&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">{}</span><span class="s2">/attr/RequestedActivation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span>  <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.RequestedActivations.Active&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.delete_image"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.delete_image">[docs]</a>    <span class="k">def</span> <span class="nf">delete_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete An Image</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/&lt;id&gt;/action/delete</span>
<span class="sd">        &quot;data&quot; : []</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># First, we try the &quot;new&quot; method, as of at least ibm-v2.0-0-r26.1-0-gfb7714a</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">{}</span><span class="s2">/action/delete&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Try falling back to the old method (everything prior? who knows)</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_image_active_complete"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_image_active_complete">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_image_active_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait For Image Active Complete</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation&#39;</span><span class="p">)</span> \
                <span class="o">==</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.Activations.Activating&quot;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Image activation is in progress&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation&#39;</span><span class="p">)</span> \
                <span class="o">==</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.Activations.Active&quot;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Image activated successfully, Good to go for power on....&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation&#39;</span><span class="p">)</span> \
                <span class="o">==</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.Activations.Failed&quot;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Image activation failed. Good luck.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPCheck</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Image is failed to activate/Timeout happened&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.host_image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.host_image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">host_image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get List of Host Image IDs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_ids</span><span class="p">(</span><span class="n">purpose</span><span class="o">=</span><span class="s1">&#39;xyz.openbmc_project.Software.Version.VersionPurpose.Host&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.bmc_image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.bmc_image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get List of BMC Image IDs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_ids</span><span class="p">(</span><span class="n">purpose</span><span class="o">=</span><span class="s1">&#39;xyz.openbmc_project.Software.Version.VersionPurpose.BMC&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">purpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get List of Image IDs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_image_ids</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[:]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
            <span class="c1"># Here, we assume that if we don&#39;t have &#39;Purpose&#39; it&#39;s something special</span>
            <span class="c1"># like the &#39;active&#39; or (new) &#39;functional&#39;.</span>
            <span class="c1"># Adriana has promised me that this is safe.</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">purpose</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Removing Image ID: </span><span class="si">{}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;Purpose=</span><span class="si">{}</span><span class="s2"> does not match purpose=</span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">),</span> <span class="n">purpose</span><span class="p">))</span>
                <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ALL Image IDs: </span><span class="si">{}</span><span class="s2"> purpose=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">purpose</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span></div>

<div class="viewcode-block" id="HostManagement.list_available_dumps"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.list_available_dumps">[docs]</a>    <span class="k">def</span> <span class="nf">list_available_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Listing available Dumps:</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/dump/list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/dump/list&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="HostManagement.get_dump_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_dump_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_dump_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get Dump IDs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dump_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_available_dumps</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dump IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;k=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/xyz/openbmc_project/dump/entry/(\d{1,})$&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">dump_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dump IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump_ids</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dump_ids</span></div>

<div class="viewcode-block" id="HostManagement.download_dump"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.download_dump">[docs]</a>    <span class="k">def</span> <span class="nf">download_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Download Dump</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/download/dump/&lt;id&gt;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/download/dump/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump_id</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">logdir</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.delete_dump"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.delete_dump">[docs]</a>    <span class="k">def</span> <span class="nf">delete_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete dump</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/dump/entry/&lt;dump_id&gt;/action/Delete</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/dump/entry/</span><span class="si">{}</span><span class="s2">/action/Delete&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump_id</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="HostManagement.delete_all_dumps"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.delete_all_dumps">[docs]</a>    <span class="k">def</span> <span class="nf">delete_all_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete all Dumps</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dump_ids</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_dump</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deleting Dump ID=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="HostManagement.create_new_dump"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.create_new_dump">[docs]</a>    <span class="k">def</span> <span class="nf">create_new_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new Dump</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/dump/action/CreateDump</span>
<span class="sd">        &quot;data&quot; : []</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/dump/action/CreateDump&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;OpenBMC Dump capture was successful&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Create Dump Exception=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dumps are exceeded in the system, trying to delete existing ones&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_all_dumps</span><span class="p">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RETRY ATTEMPT OpenBMC Dump capture was successful&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_dump_finish"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_dump_finish">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_dump_finish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_id</span><span class="p">,</span> <span class="n">counter</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wait for Dump to Finish</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">counter</span><span class="p">):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dump_ids</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">dump_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dump ID=</span><span class="si">{}</span><span class="s2"> is ready to download/offload&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump_id</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.software_enumerate"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.software_enumerate">[docs]</a>    <span class="k">def</span> <span class="nf">software_enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Software Enumerate</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="HostManagement.has_field_mode_set"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.has_field_mode_set">[docs]</a>    <span class="k">def</span> <span class="nf">has_field_mode_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Field Mode Enabled : 0=disabled 1=enabled</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">software_enumerate</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FieldModeEnabled&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unable to get FieldModeEnabled so returning False, Exception=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.set_field_mode"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_field_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_field_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set field mode : 0=disable 1=enable</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/attr/FieldModeEnabled</span>
<span class="sd">        &quot;data&quot;: 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/attr/FieldModeEnabled&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">mode</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.validate_functional_bootside"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.validate_functional_bootside">[docs]</a>    <span class="k">def</span> <span class="nf">validate_functional_bootside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Functional Boot Side Validation for both BMC and PNOR</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/functional</span>
<span class="sd">        {</span>
<span class="sd">            &quot;data&quot;: {</span>
<span class="sd">            &quot;endpoints&quot;: [</span>
<span class="sd">            &quot;/xyz/openbmc_project/software/061c4bdb&quot;,</span>
<span class="sd">            &quot;/xyz/openbmc_project/software/608e9ebe&quot;</span>
<span class="sd">            ]</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/functional&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Functional Boot Side Validation: r.text=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.is_image_already_active"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.is_image_already_active">[docs]</a>    <span class="k">def</span> <span class="nf">is_image_already_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if Image is Active</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation&#39;</span><span class="p">)</span> \
            <span class="o">==</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.Activations.Active&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.get_occ_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_occ_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_occ_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/org/open_power/control/enumerate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/org/open_power/control/enumerate&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">occ_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;k=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/org/open_power/control/occ(\d{1,})$&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">occ_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OCC IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ_ids</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">occ_ids</span></div>

<div class="viewcode-block" id="HostManagement.is_occ_active"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.is_occ_active">[docs]</a>    <span class="k">def</span> <span class="nf">is_occ_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get state of OCC&#39;s</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/org/open_power/control/occ0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/org/open_power/control/occ</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OccActive&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;# OCC</span><span class="si">{}</span><span class="s2"> is active&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;# OCC</span><span class="si">{}</span><span class="s2"> is not active&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.enable_power_cap"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.enable_power_cap">[docs]</a>    <span class="k">def</span> <span class="nf">enable_power_cap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Enable Power Cap : 0=disabled by default 1=enabled</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/power_cap/attr/PowerCapEnable</span>
<span class="sd">        &quot;data&quot; : 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/power_cap/attr/PowerCapEnable&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">enable</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.power_cap_enable"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_cap_enable">[docs]</a>    <span class="k">def</span> <span class="nf">power_cap_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Enables the Power Cap</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_power_cap</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.power_cap_disable"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_cap_disable">[docs]</a>    <span class="k">def</span> <span class="nf">power_cap_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Disables the Power Cap</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_power_cap</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.get_power_cap_settings"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_power_cap_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_power_cap_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/power_cap</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/power_cap&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">PowerCapEnable</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PowerCapEnable&#39;</span><span class="p">)</span>
        <span class="n">PowerCap</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PowerCap&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PowerCapEnable</span><span class="p">,</span> <span class="n">PowerCap</span></div>

<div class="viewcode-block" id="HostManagement.clear_gard_records"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.clear_gard_records">[docs]</a>    <span class="k">def</span> <span class="nf">clear_gard_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/org/open_power/control/gard/action/Reset</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/org/open_power/control/gard/action/Reset&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.factory_reset_software"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.factory_reset_software">[docs]</a>    <span class="k">def</span> <span class="nf">factory_reset_software</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/software/action/Reset</span>
<span class="sd">        &quot;data&quot;: []&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/action/Reset&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.factory_reset_network"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.factory_reset_network">[docs]</a>    <span class="k">def</span> <span class="nf">factory_reset_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/network/action/Reset</span>
<span class="sd">        &quot;data&quot;: []&quot;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/network/action/Reset&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.update_root_password"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.update_root_password">[docs]</a>    <span class="k">def</span> <span class="nf">update_root_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update Root Password</span>
<span class="sd">        POST</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/user/root/action/SetPassword</span>
<span class="sd">        &quot;data&quot; : [&quot;abc123&quot;]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/user/root/action/SetPassword&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">password</span><span class="p">)]}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.is_tpm_enabled"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.is_tpm_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">is_tpm_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        TPM Enablement Check 0=TPMEnable cleared 1=TPMEnable set</span>
<span class="sd">        GET</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/TPMEnable</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/TPMEnable&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TPMEnable&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;# TPMEnable is set&quot;</span><span class="p">)</span>
          <span class="k">return</span> <span class="kc">True</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;# TPMEnable is cleared&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.configure_tpm_enable"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.configure_tpm_enable">[docs]</a>    <span class="k">def</span> <span class="nf">configure_tpm_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Configure TPM Enable - 0=disable 1=enable</span>
<span class="sd">        PUT</span>
<span class="sd">        https://bmcip/xyz/openbmc_project/control/host0/TPMEnable/attr/TPMEnable</span>
<span class="sd">        &quot;data&quot; : 1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/TPMEnable/attr/TPMEnable&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">util_bmc_server</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.enable_tpm"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.enable_tpm">[docs]</a>    <span class="k">def</span> <span class="nf">enable_tpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Enable TPM</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_tpm_enable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.disable_tpm"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.disable_tpm">[docs]</a>    <span class="k">def</span> <span class="nf">disable_tpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Disable TPM</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_tpm_enable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="OpTestOpenBMC"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC">[docs]</a><span class="k">class</span> <span class="nc">OpTestOpenBMC</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ipmi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">rest_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="n">check_ssh_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">known_hosts_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span> <span class="o">=</span> <span class="n">ipmi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span> <span class="o">=</span> <span class="n">rest_api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">OpTestSSH</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">2200</span><span class="p">,</span>
                <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">check_ssh_keys</span><span class="o">=</span><span class="n">check_ssh_keys</span><span class="p">,</span>
                <span class="n">known_hosts_file</span><span class="o">=</span><span class="n">known_hosts_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span> <span class="o">=</span> <span class="n">OpTestBMC</span><span class="p">(</span><span class="n">ip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="n">check_ssh_keys</span><span class="o">=</span><span class="n">check_ssh_keys</span><span class="p">,</span>
                            <span class="n">known_hosts_file</span><span class="o">=</span><span class="n">known_hosts_file</span><span class="p">)</span>

<div class="viewcode-block" id="OpTestOpenBMC.set_system"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.set_system">[docs]</a>    <span class="k">def</span> <span class="nf">set_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">set_system</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">set_system</span><span class="p">(</span><span class="n">system</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_new_pnor_code_update"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_new_pnor_code_update">[docs]</a>    <span class="k">def</span> <span class="nf">has_new_pnor_code_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">BMC_CONST</span><span class="o">.</span><span class="n">HTTP_RETRY</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span>

        <span class="n">has_local_share_pnor</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;ls -1 /usr/local/share/pnor&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CommandFailed</span><span class="p">:</span>
            <span class="n">has_local_share_pnor</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">has_pflash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">validate_pflash_tool</span><span class="p">()</span>

        <span class="c1"># As of April 2019, now there&#39;s APIs for machies using the non-vpnor</span>
        <span class="c1"># layout. So our previosu logic of assuming that we should use pflash</span>
        <span class="c1"># only if the API is not there is now invalid.</span>
        <span class="c1"># So we have to guess, as there&#39;s no real good documented way to work</span>
        <span class="c1"># out what to do.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_local_share_pnor</span> <span class="ow">and</span> <span class="n">has_pflash</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span><span class="o">.</span><span class="n">get_list_of_image_ids</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;xyz.openbmc_project.Software.Version.VersionPurpose.Host&#39;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Host image&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;# Checking for pflash on BMC to determine update method&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">validate_pflash_tool</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.reboot"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.reboot">[docs]</a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
        <span class="c1"># After a BMC reboot, wait for it to reach ready state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span><span class="o">.</span><span class="n">wait_for_bmc_runtime</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.reboot_nowait"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.reboot_nowait">[docs]</a>    <span class="k">def</span> <span class="nf">reboot_nowait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Reboot BMC but do not wait for it to come back</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">reboot_nowait</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.image_transfer"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.image_transfer">[docs]</a>    <span class="k">def</span> <span class="nf">image_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_imageName</span><span class="p">,</span> <span class="n">copy_as</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">image_transfer</span><span class="p">(</span><span class="n">i_imageName</span><span class="p">,</span> <span class="n">copy_as</span><span class="o">=</span><span class="n">copy_as</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.pnor_img_flash_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.pnor_img_flash_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">pnor_img_flash_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnor_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">pnor_img_flash_openbmc</span><span class="p">(</span><span class="n">pnor_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.skiboot_img_flash_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.skiboot_img_flash_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">skiboot_img_flash_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lid_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_pnor_code_update</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">skiboot_img_flash_openbmc</span><span class="p">(</span><span class="n">lid_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># don&#39;t ask. There appears to be a bug where we need to be 4k aligned.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/dev/zero of=/dev/stdout bs=1M count=1 | tr &#39;</span><span class="se">\\</span><span class="s2">000&#39; &#39;</span><span class="se">\\</span><span class="s2">377&#39; &gt; /tmp/ones&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;cat /tmp/</span><span class="si">%s</span><span class="s2"> /tmp/ones &gt; /tmp/padded&quot;</span> <span class="o">%</span> <span class="n">lid_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/tmp/padded of=/usr/local/share/pnor/PAYLOAD bs=1M count=1&quot;</span><span class="p">)</span></div>
            <span class="c1">#self.bmc.run_command(&quot;mv /tmp/%s /usr/local/share/pnor/PAYLOAD&quot; % lid_name, timeout=60)</span>

<div class="viewcode-block" id="OpTestOpenBMC.skiroot_img_flash_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.skiroot_img_flash_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">skiroot_img_flash_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lid_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_pnor_code_update</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">skiroot_img_flash_openbmc</span><span class="p">(</span><span class="n">lid_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># don&#39;t ask. There appears to be a bug where we need to be 4k aligned.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/dev/zero of=/dev/stdout bs=16M count=1 | tr &#39;</span><span class="se">\\</span><span class="s2">000&#39; &#39;</span><span class="se">\\</span><span class="s2">377&#39; &gt; /tmp/ones&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;cat /tmp/</span><span class="si">%s</span><span class="s2"> /tmp/ones &gt; /tmp/padded&quot;</span> <span class="o">%</span> <span class="n">lid_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/tmp/padded of=/usr/local/share/pnor/BOOTKERNEL bs=16M count=1&quot;</span><span class="p">)</span></div>
            <span class="c1">#self.bmc.run_command(&quot;mv /tmp/%s /usr/local/share/pnor/BOOTKERNEL&quot; % lid_name, timeout=60)</span>

<div class="viewcode-block" id="OpTestOpenBMC.flash_part_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.flash_part_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">flash_part_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lid_name</span><span class="p">,</span> <span class="n">part_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_pnor_code_update</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">flash_part_openbmc</span><span class="p">(</span><span class="n">lid_name</span><span class="p">,</span> <span class="n">part_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;mv /tmp/</span><span class="si">%s</span><span class="s2"> /usr/local/share/pnor/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lid_name</span><span class="p">,</span> <span class="n">part_name</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.clear_field_mode"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.clear_field_mode">[docs]</a>    <span class="k">def</span> <span class="nf">clear_field_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;fw_setenv fieldmode&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;systemctl unmask usr-local.mount&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.bmc_host"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.bmc_host">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_host</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.get_ipmi"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.get_ipmi">[docs]</a>    <span class="k">def</span> <span class="nf">get_ipmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.get_host_console"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.get_host_console">[docs]</a>    <span class="k">def</span> <span class="nf">get_host_console</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.get_rest_api"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.get_rest_api">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_api</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.run_command"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.run_command">[docs]</a>    <span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">retry</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_inband_bootdev"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_inband_bootdev">[docs]</a>    <span class="k">def</span> <span class="nf">has_inband_bootdev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_os_boot_sensor"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_os_boot_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">has_os_boot_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_host_status_sensor"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_host_status_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">has_host_status_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_occ_active_sensor"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_occ_active_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">has_occ_active_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_ipmi_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_ipmi_sel">[docs]</a>    <span class="k">def</span> <span class="nf">has_ipmi_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.supports_ipmi_dcmi"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.supports_ipmi_dcmi">[docs]</a>    <span class="k">def</span> <span class="nf">supports_ipmi_dcmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">op-test-framework</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=open-power&repo=op-test-framework&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/open-power/op-test-framework">
    <img
        alt="https://secure.travis-ci.org/open-power/op-test-framework.svg?branch=master"
        src="https://secure.travis-ci.org/open-power/op-test-framework.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide.html">op-test User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests.html">The Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Programming Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html#generic-classes-modules">Generic Classes/Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html#bmc-machine-specific">BMC/Machine Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html#module-testcases.OpTestFlash">Firmware Flashing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, OpenPOWER Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    
    <a href="https://github.com/open-power/op-test-framework" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>